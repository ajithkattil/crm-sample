{% extends 'web/base.html' %}
{% load staticfiles %}
{% block title %}Accounts{% endblock %}
{% block account_active %}active{% endblock %}
{% block body %}
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12 col-sm-12">
                <div class="card" style="margin-top: 1em">
                    <div class="card-body">
                        <i class="fa fa-building" style="font-size:48px;"></i>
                        <div style="display: inline-block">
                            <h4 class="page-titles">Accounts</h4>
                        </div>
                        <br>
                        <div class="input-group">

                            Sort by:&nbsp;
                            <select class="custom-select" id="sortsel">
                                <option selected value="1">Name</option>
                                <option value="2">Added On</option>
                                <option value="3">Owner</option>
                            </select>
                            &nbsp;
                            <div class="input-group col-sm-3">
                                <input type="search" class="form-control">
                                <span class="input-group-btn">
                                    <button class="btn btn-primary" type="button"><i class="fa fa-search" aria-hidden="true"></i></button>
                                </span>
                            </div>
                        </div>
                        <div style="position: absolute; right: 2%;">
                            <label class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="myaccchk">
                                <span class="custom-control-indicator"></span>
                                <span class="custom-control-description">My accounts only</span>
                            </label>
                            <button class="btn btn-success" title="Add a new account" id="addbtn"><i class="fa fa-plus"></i></button>
{#                            <button class="btn btn-danger" title="Delete" id="dltbtn"><i class="fa fa-trash"></i></button>#}
                        </div>
                        <br>
                        <br>
                        <br>
                        {# The table comes here #}
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th>Name</th>
                                    <th>Website</th>
                                    <th>Phone</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                        <div style="position: absolute; right: 2%;">
                            <button type="button" class="btn btn-primary"><i class="fa fa-arrow-left"></i>&nbsp;Previous</button>
                            &nbsp;
                            <input type="text" placeholder="Index..." size="10%" id="pgidx">
                            &nbsp;
                            <button type="button" class="btn btn-primary">Next&nbsp;<i class="fa fa-arrow-right"></i></button>
                        </div>
                        <br>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block js_scripts %}
    <script src="{% static 'js/compareChart.js' %}"></script>
    <script>
    $("#pgidx").keypress(function(event) {
        if (event.which === 13) {
            event.preventDefault();
            var start = parseInt($('#pgidx').val());
            var end = start + 10;
        }
    });

    var start = 0;
    var end = start + 10;


    function tryParseJSON (jsonString){
        try {
            var o = JSON.parse(jsonString);
            if (o && typeof o === "object") {
                return o;
            }
        }
        catch (e) { }
        return false;
    }


    function getTable(start, end) {
        // Get checkbox value here.
        // And also the my accounts only checkbox
        var dtype = 'json';
        var xhttp = XMLReq(fillTable);
        var local = window.location.origin;
        xhttp.open("GET", local + '/api/accounts/' + dtype + '/' + start + '/' + end, true);
        xhttp.send();
    }


    function fillTable(data) {
        var parsed = tryParseJSON(data);
        if (parsed === false) {
            //It's not JSON. It's something.
        }

        else {
            for (var obj in parsed) {
                var ob = parsed[obj];
                var pk = ob['pk'];
                var fields = ob['fields'];
                var name = fields['name'];
                var website = fields['website'];
                var phone = fields['phone_number'];
                var owner = fields['owner'];
                var added_on = fields['added_on'];
                var subsidiary_of = fields['subsidiary_of'];
                // Now add the table. :)
                var markup = "<tr><td>" + (start + parseInt(obj) + 1) + "</td><td>" +'<a href="/accounts/' + pk + '">' +
                    name + '</a>' + "</td><td>" + website +"</td><td>"+ phone + "</td></tr>";
                $('table tbody').append(markup);
            }
        }
    }

    getTable(0,10);
    </script>
{% endblock %}